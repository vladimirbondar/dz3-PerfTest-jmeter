# Домашнее задание №3

**Задача:**

1. Разработать профиль нагрузки для системы
2. Реализовать профиль на любом инструменте НТ (разработать скрипт)
3. Задать нефункциональные требования по производительности к системе (SLO/SLA)
4. Найти максимальную производительность системы
5. Написать краткий вывод: где достигнута максимальная производительность, где узкое место в системе, для подтверждения привести графики.

## 1. Профиль нагрузки

<details> <summary>  Описание SRE Course API и реализации тестовой конфигурации</summary> <br>

> SRE course weather API обеспечивает доступ к БД "weather" с таблицами "cities" и "forecast".
> 
> Доступные запросы:
> 
> - Cities: GET /Cities/{id}; PUT /Cities/{id}; POST /Cities; GET /Cities
> - Forecast: GET /Forecast/{id}; PUT /Forecast/{id}; POST /Forecast/{cityId}; GET /Forecast
> - WeatherForecast: GET /WeatherForecast

![ Схема API](./pics/swagger_scheme.png)

</details>

<details> <summary>  Наполнение тестовой базы API </summary> <br>

> **Table Cities:** 170 записей. Список  городов России с населением более 100 тыс.
> **Table Forecast:** 1190 записей. Список записей о прогноза погоды на 7 дней для каждого города.
</details>

------------

Предполагается, что пользователи будут встраивать код, использующий API, в свои приложения и веб-сайты.
Профили, использующие GET:

>1. CitySelect: Получение списка городов для выбора и сохранения идентификатора города в настройках клиентского приложения. (GET /Cities).
>2. City-1: Получение и вывод прогноза погоды для одного города на текущую дату. (GET /Forecast)
>3. City-7: Получение и вывод прогноза погоды для одного города на неделю. (GET /Forecast)
>4. Russia-1: Получение и вывод прогноза погоды для всех городов на текущую дату. (GET /Cities; GET /Forecast)
>5. Russia-7: Получение и вывод прогноза погоды для всех городов на неделю. (GET /Cities; GET /Forecast)

Для Нагрузочного Тестирования целесообразно **использовать профили "City"**. Эти профили предсматривают автоматическое выполненеие по событию или по таймеру и могут генерировать существенную нагрузку.

Остальные профили предусматривают интерактивный режим запуска и существенно меньше нагружают сервис API.

------------
## 2. Реализация профиля НТ City на Jmeter

Для реализации профиля используется файл JMeter test plan City-profile-xxx.jmx со следующими элементами:

"HTTP Request defaults": http://91.185.85.213/
"HTTP Header Manager": Host:weather.sre.student12
"Throughput Shaping Timer": sets request rate shcedule
"jp@gc - Ultimate Thread Group"
"HTTP Request": path: /forecast/
"Constant Timer": Thread delay: 300
- Start RPS: 1, End RPS: xxx, Duration: 600
- Start RPS: xxx, End RPS: 0, Duration: 30

------------
## 3. Нефункциональные требования к системе по производительности

Для нашего API я определил следующие SLI:
- Время отклика (ms)
- Пропускная способность: количество запросов (RPS)
- Уровень ошибок: процент запросов

SLO:
- 95% запросов должны быть выполнены в течение 500 мс
- пропускная способность 100 RPS
- менее 1% запросов должно приводить к ошибке

## 4. Максимальная производительность системы

Для определения макс. прозводительности состемы подготовлен НТ профиля City c постепенным увеличением RPS с 1 до 100.  
* ![Test plan до 100 RPS]() 

Тестирование выявило появление ошибок при нагузке около 50 RPS. Т.о. максимальная производительность системы 50 RPS.

** Рузультаты теста

* Test plan до 100 RPS


## 5. Вывод



------------
------------

/weatherforecast/
параметры запроса
bytes/request, sentBytes/request
150000, 139

проблемы производительности фиксируются около нагрузки 10 RPS
длительное тестирование с нагрузкой 8 RPS проходит успешно:

1. PASS 99.87% FAIL 0.13%
2. Response Time Percentiles ms  
50 - 0677  
90 - 1179  
95 - 1313  
98 - 1500  
99 - 1754

/forecast/
